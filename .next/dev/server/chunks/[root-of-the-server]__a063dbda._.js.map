{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/khaled/Downloads/vin/GlobalVin-master/src/lib/db/connect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI = process.env.MONGODB_URI!;\n\nif (!MONGODB_URI) {\n  throw new Error(\"Please define the MONGODB_URI environment variable inside .env.local\");\n}\n\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function connectDB(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      console.log(\"âœ… MongoDB connected successfully\");\n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default connectDB;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAYA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/khaled/Downloads/vin/GlobalVin-master/src/lib/db/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document, Model } from \"mongoose\";\nimport bcrypt from \"bcryptjs\";\n\n// User Roles enum values (matching auth.types.ts)\nexport const UserRoleValues = {\n  SUPER_ADMIN: \"super_admin\",\n  FRANCHISE_ADMIN: \"franchise_admin\",\n  FRANCHISE_USER: \"franchise_user\",\n} as const;\n\n// Permission enum values (matching auth.types.ts)\nexport const PermissionValues = {\n  VIEW_ALL_FRANCHISES: \"view_all_franchises\",\n  MANAGE_FRANCHISES: \"manage_franchises\",\n  VIEW_OWN_FRANCHISE: \"view_own_franchise\",\n  VIEW_ALL_BILLING: \"view_all_billing\",\n  MANAGE_ALL_PRICING: \"manage_all_pricing\",\n  VIEW_OWN_BILLING: \"view_own_billing\",\n  MANAGE_OWN_BILLING: \"manage_own_billing\",\n  TOPUP_CREDITS: \"topup_credits\",\n  MANAGE_FRANCHISE_USERS: \"manage_franchise_users\",\n  VIEW_ALL_REPORTS: \"view_all_reports\",\n  VIEW_FRANCHISE_REPORTS: \"view_franchise_reports\",\n  VIEW_OWN_REPORTS: \"view_own_reports\",\n  VIEW_ALL_ACTIVITY: \"view_all_activity\",\n  VIEW_FRANCHISE_ACTIVITY: \"view_franchise_activity\",\n  MANAGE_ALL_API: \"manage_all_api\",\n  MANAGE_FRANCHISE_API: \"manage_franchise_api\",\n  IMPERSONATE_FRANCHISE: \"impersonate_franchise\",\n} as const;\n\n// Role to Permissions mapping\nexport const ROLE_PERMISSIONS: Record<string, string[]> = {\n  [UserRoleValues.SUPER_ADMIN]: Object.values(PermissionValues),\n  [UserRoleValues.FRANCHISE_ADMIN]: [\n    PermissionValues.VIEW_OWN_FRANCHISE,\n    PermissionValues.VIEW_OWN_BILLING,\n    PermissionValues.MANAGE_OWN_BILLING,\n    PermissionValues.TOPUP_CREDITS,\n    PermissionValues.MANAGE_FRANCHISE_USERS,\n    PermissionValues.VIEW_FRANCHISE_REPORTS,\n    PermissionValues.VIEW_FRANCHISE_ACTIVITY,\n    PermissionValues.MANAGE_FRANCHISE_API,\n  ],\n  [UserRoleValues.FRANCHISE_USER]: [\n    PermissionValues.VIEW_OWN_FRANCHISE,\n    PermissionValues.VIEW_OWN_REPORTS,\n  ],\n};\n\n// User document interface\nexport interface IUser extends Document {\n  _id: mongoose.Types.ObjectId;\n  name: string;\n  email: string;\n  password: string;\n  role: string;\n  franchiseId?: mongoose.Types.ObjectId | null;\n  avatar?: string | null;\n  permissions: string[];\n  createdAt: Date;\n  updatedAt: Date;\n  comparePassword(candidatePassword: string): Promise<boolean>;\n}\n\n// User schema\nconst userSchema = new Schema<IUser>(\n  {\n    name: {\n      type: String,\n      required: [true, \"Name is required\"],\n      trim: true,\n      minlength: [2, \"Name must be at least 2 characters\"],\n      maxlength: [50, \"Name cannot exceed 50 characters\"],\n    },\n    email: {\n      type: String,\n      required: [true, \"Email is required\"],\n      unique: true,\n      lowercase: true,\n      trim: true,\n      match: [/^\\S+@\\S+\\.\\S+$/, \"Please provide a valid email\"],\n    },\n    password: {\n      type: String,\n      required: [true, \"Password is required\"],\n      minlength: [6, \"Password must be at least 6 characters\"],\n      select: false, // Don't include password in queries by default\n    },\n    role: {\n      type: String,\n      enum: Object.values(UserRoleValues),\n      default: UserRoleValues.FRANCHISE_USER,\n    },\n    franchiseId: {\n      type: Schema.Types.ObjectId,\n      ref: \"Franchise\",\n      default: null,\n    },\n    avatar: {\n      type: String,\n      default: null,\n    },\n    permissions: {\n      type: [String],\n      default: [],\n    },\n  },\n  {\n    timestamps: true,\n  }\n);\n\n// Pre-save middleware to hash password\nuserSchema.pre(\"save\", async function () {\n  // Only hash the password if it's modified (or new)\n  if (!this.isModified(\"password\")) {\n    return;\n  }\n\n  const salt = await bcrypt.genSalt(10);\n  this.password = await bcrypt.hash(this.password, salt);\n\n  // Set permissions based on role\n  this.permissions = ROLE_PERMISSIONS[this.role] || [];\n});\n\n// Method to compare password\nuserSchema.methods.comparePassword = async function (\n  candidatePassword: string\n): Promise<boolean> {\n  return bcrypt.compare(candidatePassword, this.password);\n};\n\n// Transform output to match frontend User interface\nuserSchema.set(\"toJSON\", {\n  transform: (doc, ret) => {\n    ret.id = ret._id.toString();\n    delete ret._id;\n    delete ret.__v;\n    delete ret.password;\n    return ret;\n  },\n});\n\n// Prevent model recompilation in development\nconst User: Model<IUser> =\n  mongoose.models.User || mongoose.model<IUser>(\"User\", userSchema);\n\nexport default User;\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAGO,MAAM,iBAAiB;IAC5B,aAAa;IACb,iBAAiB;IACjB,gBAAgB;AAClB;AAGO,MAAM,mBAAmB;IAC9B,qBAAqB;IACrB,mBAAmB;IACnB,oBAAoB;IACpB,kBAAkB;IAClB,oBAAoB;IACpB,kBAAkB;IAClB,oBAAoB;IACpB,eAAe;IACf,wBAAwB;IACxB,kBAAkB;IAClB,wBAAwB;IACxB,kBAAkB;IAClB,mBAAmB;IACnB,yBAAyB;IACzB,gBAAgB;IAChB,sBAAsB;IACtB,uBAAuB;AACzB;AAGO,MAAM,mBAA6C;IACxD,CAAC,eAAe,WAAW,CAAC,EAAE,OAAO,MAAM,CAAC;IAC5C,CAAC,eAAe,eAAe,CAAC,EAAE;QAChC,iBAAiB,kBAAkB;QACnC,iBAAiB,gBAAgB;QACjC,iBAAiB,kBAAkB;QACnC,iBAAiB,aAAa;QAC9B,iBAAiB,sBAAsB;QACvC,iBAAiB,sBAAsB;QACvC,iBAAiB,uBAAuB;QACxC,iBAAiB,oBAAoB;KACtC;IACD,CAAC,eAAe,cAAc,CAAC,EAAE;QAC/B,iBAAiB,kBAAkB;QACnC,iBAAiB,gBAAgB;KAClC;AACH;AAiBA,cAAc;AACd,MAAM,aAAa,IAAI,mHAAM,CAC3B;IACE,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAmB;QACpC,MAAM;QACN,WAAW;YAAC;YAAG;SAAqC;QACpD,WAAW;YAAC;YAAI;SAAmC;IACrD;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAAoB;QACrC,QAAQ;QACR,WAAW;QACX,MAAM;QACN,OAAO;YAAC;YAAkB;SAA+B;IAC3D;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAuB;QACxC,WAAW;YAAC;YAAG;SAAyC;QACxD,QAAQ;IACV;IACA,MAAM;QACJ,MAAM;QACN,MAAM,OAAO,MAAM,CAAC;QACpB,SAAS,eAAe,cAAc;IACxC;IACA,aAAa;QACX,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,SAAS;IACX;IACA,QAAQ;QACN,MAAM;QACN,SAAS;IACX;IACA,aAAa;QACX,MAAM;YAAC;SAAO;QACd,SAAS,EAAE;IACb;AACF,GACA;IACE,YAAY;AACd;AAGF,uCAAuC;AACvC,WAAW,GAAG,CAAC,QAAQ;IACrB,mDAAmD;IACnD,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa;QAChC;IACF;IAEA,MAAM,OAAO,MAAM,4KAAM,CAAC,OAAO,CAAC;IAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,4KAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;IAEjD,gCAAgC;IAChC,IAAI,CAAC,WAAW,GAAG,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;AACtD;AAEA,6BAA6B;AAC7B,WAAW,OAAO,CAAC,eAAe,GAAG,eACnC,iBAAyB;IAEzB,OAAO,4KAAM,CAAC,OAAO,CAAC,mBAAmB,IAAI,CAAC,QAAQ;AACxD;AAEA,oDAAoD;AACpD,WAAW,GAAG,CAAC,UAAU;IACvB,WAAW,CAAC,KAAK;QACf,IAAI,EAAE,GAAG,IAAI,GAAG,CAAC,QAAQ;QACzB,OAAO,IAAI,GAAG;QACd,OAAO,IAAI,GAAG;QACd,OAAO,IAAI,QAAQ;QACnB,OAAO;IACT;AACF;AAEA,6CAA6C;AAC7C,MAAM,OACJ,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEzC","debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/khaled/Downloads/vin/GlobalVin-master/src/app/api/auth/register/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport jwt from \"jsonwebtoken\";\nimport connectDB from \"@/lib/db/connect\";\nimport User from \"@/lib/db/models/User\";\n\nconst JWT_SECRET = process.env.JWT_SECRET!;\nconst JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || \"7d\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    await connectDB();\n\n    const body = await request.json();\n    const { name, email, password, role, franchiseId } = body;\n\n    // Validation\n    if (!name || !email || !password) {\n      return NextResponse.json(\n        { message: \"Name, email and password are required\" },\n        { status: 400 }\n      );\n    }\n\n    if (password.length < 6) {\n      return NextResponse.json(\n        { message: \"Password must be at least 6 characters\" },\n        { status: 400 }\n      );\n    }\n\n    // Check if user already exists\n    const existingUser = await User.findOne({ email: email.toLowerCase() });\n    if (existingUser) {\n      return NextResponse.json(\n        { message: \"User with this email already exists\" },\n        { status: 400 }\n      );\n    }\n\n    // Create new user\n    const user = await User.create({\n      name,\n      email: email.toLowerCase(),\n      password,\n      role: role || \"franchise_user\",\n      franchiseId: franchiseId || null,\n    });\n\n    // Generate JWT token\n    const token = jwt.sign(\n      { userId: user._id, email: user.email, role: user.role },\n      JWT_SECRET,\n      { expiresIn: JWT_EXPIRES_IN }\n    );\n\n    // Return user data (password excluded by schema)\n    const userData = user.toJSON();\n\n    return NextResponse.json(\n      {\n        message: \"Registration successful\",\n        data: {\n          token,\n          user: userData,\n        },\n      },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error(\"Registration error:\", error);\n\n    // Handle mongoose validation errors\n    if (error instanceof Error && error.name === \"ValidationError\") {\n      return NextResponse.json(\n        { message: error.message },\n        { status: 400 }\n      );\n    }\n\n    return NextResponse.json(\n      { message: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU;AACzC,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AAE9C,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,IAAA,sKAAS;QAEf,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG;QAErD,aAAa;QACb,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU;YAChC,OAAO,8KAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAwC,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,SAAS,MAAM,GAAG,GAAG;YACvB,OAAO,8KAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAyC,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,+BAA+B;QAC/B,MAAM,eAAe,MAAM,6KAAI,CAAC,OAAO,CAAC;YAAE,OAAO,MAAM,WAAW;QAAG;QACrE,IAAI,cAAc;YAChB,OAAO,8KAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAsC,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAM,OAAO,MAAM,6KAAI,CAAC,MAAM,CAAC;YAC7B;YACA,OAAO,MAAM,WAAW;YACxB;YACA,MAAM,QAAQ;YACd,aAAa,eAAe;QAC9B;QAEA,qBAAqB;QACrB,MAAM,QAAQ,gLAAG,CAAC,IAAI,CACpB;YAAE,QAAQ,KAAK,GAAG;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC,GACvD,YACA;YAAE,WAAW;QAAe;QAG9B,iDAAiD;QACjD,MAAM,WAAW,KAAK,MAAM;QAE5B,OAAO,8KAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,MAAM;gBACJ;gBACA,MAAM;YACR;QACF,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QAErC,oCAAoC;QACpC,IAAI,iBAAiB,SAAS,MAAM,IAAI,KAAK,mBAAmB;YAC9D,OAAO,8KAAY,CAAC,IAAI,CACtB;gBAAE,SAAS,MAAM,OAAO;YAAC,GACzB;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,8KAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAwB,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}